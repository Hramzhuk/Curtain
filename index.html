<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>YarOS</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="calc/style.css">
    <link id="theme" rel="stylesheet" href="standart.css">
    <link rel="shortcut icon" type="image/x-icon" href="icon.ico">
</head>

<body class="start-download">
    <div class="download-screen">
        <div class="welcome">Добро пожаловать в YarOS</div>
        <div id="greyProgress">
            <div id="greenBar">10%</div>
        </div>
    </div>
    <div class="wrapper hide-os">

        <div class="header">

            <div class="button" title="открыть меню">Y</div>
            <div class="menu">
                <ul class="menu-items">
                    <li onclick="app.showWindow()" title="открыть вкладку приложения">Приложения</li>
                    <li onclick="options.showWindow()" title="открыть вкладку настройки">Настройки</li>
                    <li onclick="sysInfo.showWindow()" title="открыть вкладку система">Система</li>
                    <li><a class="donation" href="https://yoomoney.ru/to/4100116303857614">Пожертвовать</a></li>
                    <li><a class="report" href="https://forms.gle/dWQDAhM8pBCjmru7A">Сообщить о баге </a></li>

                </ul>
            </div>
        </div>
        <div class="bottom-calendar">
            <div class="date" title="Часы"></div>
            <table id="calendar2">
                <thead>
                    <tr>
                        <td>‹
                        <td colspan="5">
                        <td>›
                    </tr>
                    <tr>
                        <td>Пн
                        <td>Вт
                        <td>Ср
                        <td>Чт
                        <td>Пт
                        <td>Сб
                        <td>Вс
                    </tr>
                <tbody>
            </table>
        </div>
    </div>

    <div class="window-standart app">
        <div class="window-head">
            <span class="name-window">приложения</span>
            <button class="close-btn" onclick="app.closeWindow()" title="закрыть">X</button>
            <button class="collapse-btn" onclick="app.folding()" title="свернуть">&lt;</button>
        </div>
        <div class="main-window">
            <button onclick="calc.showWindow()">Calc</button>
        </div>
    </div>

    <div class="window-standart system">
        <div class="window-head-system">
            <span class="name-window">информация о системе</span>
            <button class="close-btn" onclick="sysInfo.closeWindow()" title="закрыть">X</button>
            <button class="collapse-btn" onclick="sysInfo.folding()" title="свернуть">&lt;</button>
        </div>
        <div class="main-window">
            <p>Операционная сиcтема: YarOS</p>
            <p>Версия: 2.2.1</p>
            <p>Тип: 64(бит)</p>
            <p>Создана: 12 Апреля 2020 г.</p>
        </div>
    </div>

    <div class="window-standart options">
        <div class="window-head">
            <span class="name-window">настройки системы</span>
            <button class="close-btn" onclick="options.closeWindow()" title="закрыть">X</button>
            <button class="collapse-btn" onclick="options.folding()" title="свернуть">&lt;</button>

        </div>
        <div class="main-window">
            <p>
                Тема:
                <select name="" id="select-theme" style="background: #cddc39;">
                    <option value="standart">Стандартная</option>
                    <option value="winter">Зимняя тема</option>
                    <option value="chrismas">chrismas</option>
                </select>
            </p>
        </div>
    </div>
        <div class="window-standart calc">
        <div class="window-head">
            <span class="name-window">Калькулятор</span>
            <button class="close-btn" onclick="calc.closeWindow()" title="закрыть">X</button>
            <button class="collapse-btn" onclick="calc.folding()" title="свернуть">&lt;</button>
        </div>
        <div class="container">
            <div class="view">0</div>
        </div>

        <script src="calc/calc.js"></script>
        <div class="main-window">

        </div>
    </div>
    <div class="folding">

    </div>
    <script>
        var colors = {
            'liteGreen': '#cddc39',
            'purple': '#673ab7',
            'darkGreen': '#4caf50',
            'brown': '#795548',
            'helloween': 'url(helloween.jpg)'
        }


        class OsWindow {

            constructor(className) {
                this.selector = '.' + className; //Alex: используется здесь и в makeDraggable()
                this.element = document.querySelector(this.selector);
            }

            showWindow() {
                this.element.style.display = 'block';
                this.element.style.zIndex = OsWindow.prototype.priore++; //Alex
            }

            closeWindow() {
                this.element.style.display = 'none';

            }

            folding() {
                this.element.style.left = '-1000px';
                var newEl = document.createElement('div');
                newEl.className = 'window-fold';
                newEl.innerHTML = this.element.children[0].children[0].innerHTML[0].toUpperCase();
                var cls = this.selector; //Alex
                newEl.onclick = function() {
                    OsWindow.prototype.priore++;
                    document.querySelector(cls).style.left = "35%";
                    document.querySelector(cls).style.zIndex = OsWindow.prototype.priore;
                    newEl.remove();
                }
                document.querySelector('.folding').append(newEl);
            }
        }
        OsWindow.prototype.priore = 1;


        var app = new OsWindow('app');
        var options = new OsWindow('options');
        var sysInfo = new OsWindow('system');
        var calc = new OsWindow('calc');

        const windows = [app, options, sysInfo, calc]; //Alex

        /* //Alex: Не используется
        function openWindow(elClass) {
            document.querySelector('.' + elClass).style.display = 'block';
            document.querySelector('.' + elClass).style.zIndex = priore;
            priore++
        }
        */

        /* Функция смены темы */
        document.querySelector('#select-theme').onchange = function() {
            var sel = document.querySelector('#select-theme');
            document.querySelector('#theme').href = sel.value + '.css';
            sel.style.background = colors[sel.value];
            localStorage.theme = sel.value;
        }

        //        function folding(cls) {
        //            var el = document.querySelector('.' + cls);
        //            el.style.left = '-1000px';
        //            var newEl = document.createElement('div');
        //            newEl.className = 'window-fold';
        //            newEl.innerHTML = el.children[0].children[0].innerHTML[0].toUpperCase();
        //            newEl.onclick = function() {
        //                priore++
        //                el.style.left = "35%";
        //                el.style.zIndex = priore;
        //                newEl.remove();
        //            }
        //            document.querySelector('.folding').append(newEl);
        //        }

        document.querySelector('.button').onclick = function() {
            document.querySelector('.menu').classList.toggle('menu-open')

        }
        window.onload = setInterval(function() {
            a = new Date();
            document.querySelector('.date').innerHTML = a.toLocaleTimeString();

            //Alex
            windows.forEach(function(w) {
                makeDraggable(w.selector);
            });

        }, 1000)

        function move() {
            var elem = document.getElementById("greenBar");
            var width = 10;
            var id = setInterval(frame, 40);

            function frame() {
                if (width >= 100) {
                    clearInterval(id);
                } else {
                    width++;
                    elem.style.width = width + '%';
                    elem.innerHTML = width * 1 + '%';

                }

            }

        }
        move()

        function download() {
            if (localStorage.theme) {
                document.querySelector('#theme').href = localStorage.theme + '.css';
                document.querySelector('#select-theme').value = localStorage.theme;
            }
            document.querySelector('body').classList.toggle('start-download');
            document.querySelector('.download-screen').style.display = "none";
            document.querySelector('.wrapper').classList.toggle('hide-os');
        }
        setTimeout(download, 3700);


        /*
        var dragWindow = document.querySelector('.app');

        dragWindow.ondblclick = function(e) { // 1. отследить нажатие

            // подготовить к перемещению
            // 2. разместить на том же месте, но в абсолютных координатах
            moveAt(e);
            // переместим в body, чтобы мяч был точно не внутри position:relative
            document.body.appendChild(dragWindow);

            dragWindow.style.zIndex = 1000; // показывать мяч над другими элементами

            // передвинуть мяч под координаты курсора
            // и сдвинуть на половину ширины/высоты для центрирования
            function moveAt(e) {
                console.log(e.pageY);
                if (e.pageX < 1146 & e.pageX > 132 & e.pageY > 169 & e.pageY < 562) {
                    dragWindow.style.left = e.pageX - dragWindow.offsetWidth / 2 + 'px';
                    dragWindow.style.top = e.pageY - dragWindow.offsetHeight / 2 + 'px';
                }

            }

            // 3, перемещать по экрану
            document.onmousemove = function(e) {
                moveAt(e);
            }

            // 4. отследить окончание переноса
            dragWindow.onmouseup = function() {
                document.onmousemove = null;
                dragWindow.onmouseup = null;
            }
        }
        */

        //Alex
        function makeDraggable(sel) {
            var wnd = document.querySelector(sel);
            wnd.ondblclick = function(e) {
                // подготовить к перемещению
                // 2. разместить на том же месте, но в абсолютных координатах
                moveAt(e);
                // переместим в body, чтобы мяч был точно не внутри position:relative
                document.body.appendChild(wnd);

                wnd.style.zIndex = 1000; // показывать мяч над другими элементами

                // передвинуть мяч под координаты курсора
                // и сдвинуть на половину ширины/высоты для центрирования
                function moveAt(e) {
                    console.log('x ' + e.pageX);
                    console.log('y ' + e.pageY);
                    if (e.pageX < 1146 & e.pageX > 132 & e.pageY > 169 & e.pageY < 562) {
                        wnd.style.left = e.pageX - wnd.offsetWidth / 2 + 'px';
                        wnd.style.top = e.pageY - wnd.offsetHeight / 2 + 'px';
                    }

                }

                // 3, перемещать по экрану
                document.onmousemove = function(e) {
                    moveAt(e);
                }

                // 4. отследить окончание переноса
                wnd.onmouseup = function() {
                    document.onmousemove = null;
                    wnd.onmouseup = null;
                }
            }
        }


        function Calendar2(id, year, month) {
            var Dlast = new Date(year, month + 1, 0).getDate(),
                D = new Date(year, month, Dlast),
                DNlast = new Date(D.getFullYear(), D.getMonth(), Dlast).getDay(),
                DNfirst = new Date(D.getFullYear(), D.getMonth(), 1).getDay(),
                calendar = '<tr>',
                month = ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"];
            if (DNfirst != 0) {
                for (var i = 1; i < DNfirst; i++) calendar += '<td>';
            } else {
                for (var i = 0; i < 6; i++) calendar += '<td>';
            }
            for (var i = 1; i <= Dlast; i++) {
                if (i == new Date().getDate() && D.getFullYear() == new Date().getFullYear() && D.getMonth() == new Date().getMonth()) {
                    calendar += '<td class="today">' + i;
                } else {
                    calendar += '<td>' + i;
                }
                if (new Date(D.getFullYear(), D.getMonth(), i).getDay() == 0) {
                    calendar += '<tr>';
                }
            }
            for (var i = DNlast; i < 7; i++) calendar += '<td>&nbsp;';
            document.querySelector('#' + id + ' tbody').innerHTML = calendar;
            document.querySelector('#' + id + ' thead td:nth-child(2)').innerHTML = month[D.getMonth()] + ' ' + D.getFullYear();
            document.querySelector('#' + id + ' thead td:nth-child(2)').dataset.month = D.getMonth();
            document.querySelector('#' + id + ' thead td:nth-child(2)').dataset.year = D.getFullYear();
            if (document.querySelectorAll('#' + id + ' tbody tr').length < 6) { // чтобы при перелистывании месяцев не "подпрыгивала" вся страница, добавляется ряд пустых клеток. Итог: всегда 6 строк для цифр
                document.querySelector('#' + id + ' tbody').innerHTML += '<tr><td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;';
            }
        }
        Calendar2("calendar2", new Date().getFullYear(), new Date().getMonth());
        // переключатель минус месяц
        document.querySelector('#calendar2 thead tr:nth-child(1) td:nth-child(1)').onclick = function() {
            Calendar2("calendar2", document.querySelector('#calendar2 thead td:nth-child(2)').dataset.year, parseFloat(document.querySelector('#calendar2 thead td:nth-child(2)').dataset.month) - 1);
        }
        // переключатель плюс месяц
        document.querySelector('#calendar2 thead tr:nth-child(1) td:nth-child(3)').onclick = function() {
            Calendar2("calendar2", document.querySelector('#calendar2 thead td:nth-child(2)').dataset.year, parseFloat(document.querySelector('#calendar2 thead td:nth-child(2)').dataset.month) + 1);
        }

        ////////////////////////
        ///////// Настройки
        ////////////////////////

        // количество снежинок, которое будет на экране одновременно.
        var snowmax = 300

        // Цвета для снежинок. Для каждой конкретной снежинки цвет выбирается случайно из этого массива.
        var snowcolor = new Array("#b9dff5", "#7fc7ff", "#7fb1ff", "#7fc7ff", "#b9dff5")

        // Шрифт для снежинок
        var snowtype = new Array("Times")

        // Символ (*) и есть снежинка, в место нее можно вставить любой другой символ.
        var snowletter = "&#10052;"

        // Скорость движения снежинок (от 0.3 до 2)
        var sinkspeed = 0.4

        // Максимальный размер для снежинок
        var snowmaxsize = 40

        // Минимальный размер для снежинок
        var snowminsize = 10

        // Зона для снежинок
        // 1 для всей страницы, 2 в левой части страницы
        // 3 в центральной части, 4 в правой части страницы
        var snowingzone = 1

        ////////////////////////
        ///////// Конец настроек
        ////////////////////////

        var snow = new Array()
        var marginbottom
        var marginright
        var timer
        var i_snow = 0
        var x_mv = new Array();
        var crds = new Array();
        var lftrght = new Array();
        var browserinfos = navigator.userAgent
        var ie5 = document.all && document.getElementById && !browserinfos.match(/Opera/)
        var ns6 = document.getElementById && !document.all
        var opera = browserinfos.match(/Opera/)
        var browserok = ie5 || ns6 || opera

        function randommaker(range) {
            rand = Math.floor(range * Math.random())
            return rand
        }

        function initsnow() {
            if (ie5 || opera) {
                marginbottom = document.documentElement.clientHeight + 50
                marginright = document.body.clientWidth - 15
            } else if (ns6) {
                marginbottom = document.documentElement.clientHeight + 507
                marginright = window.innerWidth - 15
            }
            var snowsizerange = snowmaxsize - snowminsize
            for (i = 0; i <= snowmax; i++) {
                crds[i] = 0;
                lftrght[i] = Math.random() * 15;
                x_mv[i] = 0.03 + Math.random() / 10;
                snow[i] = document.getElementById("s" + i)
                snow[i].style.fontFamily = snowtype[randommaker(snowtype.length)]
                snow[i].size = randommaker(snowsizerange) + snowminsize
                snow[i].style.fontSize = snow[i].size + 'px';
                snow[i].style.color = snowcolor[randommaker(snowcolor.length)]
                snow[i].style.zIndex = 1000
                snow[i].sink = sinkspeed * snow[i].size / 5
                if (snowingzone == 1) {
                    snow[i].posx = randommaker(marginright - snow[i].size)
                }
                if (snowingzone == 2) {
                    snow[i].posx = randommaker(marginright / 2 - snow[i].size)
                }
                if (snowingzone == 3) {
                    snow[i].posx = randommaker(marginright / 2 - snow[i].size) + marginright / 4
                }
                if (snowingzone == 4) {
                    snow[i].posx = randommaker(marginright / 2 - snow[i].size) + marginright / 2
                }
                snow[i].posy = randommaker(2 * marginbottom - marginbottom - 2 * snow[i].size)
                snow[i].style.left = snow[i].posx + 'px';
                snow[i].style.top = snow[i].posy + 'px';
            }
            movesnow()
        }

        function movesnow() {
            for (i = 0; i <= snowmax; i++) {
                crds[i] += x_mv[i];
                snow[i].posy += snow[i].sink
                snow[i].style.left = snow[i].posx + lftrght[i] * Math.sin(crds[i]) + 'px';
                snow[i].style.top = snow[i].posy + 'px';

                if (snow[i].posy >= marginbottom - 2 * snow[i].size || parseInt(snow[i].style.left) > (marginright - 3 * lftrght[i])) {
                    if (snowingzone == 1) {
                        snow[i].posx = randommaker(marginright - snow[i].size)
                    }
                    if (snowingzone == 2) {
                        snow[i].posx = randommaker(marginright / 2 - snow[i].size)
                    }
                    if (snowingzone == 3) {
                        snow[i].posx = randommaker(marginright / 2 - snow[i].size) + marginright / 4
                    }
                    if (snowingzone == 4) {
                        snow[i].posx = randommaker(marginright / 2 - snow[i].size) + marginright / 2
                    }
                    snow[i].posy = 0
                }
            }
            var timer = setTimeout("movesnow()", 50)
        }

        for (i = 0; i <= snowmax; i++) {
            document.body.insertAdjacentHTML('beforeend', "<span id='s" + i + "' style='user-select:none;position:fixed;top:-" + snowmaxsize + "'>" + snowletter + "</span>")
        }

        if (browserok) {
            window.onload = initsnow
        }
    </script>
</body></html>
