<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>YarOS</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="calc/style.css">
    <link id="theme" rel="stylesheet" href="css/standart.css">
    <link rel="shortcut icon" type="image/x-icon" href="YarOS_Logo_fav.jpg">
</head>

<body class="start-download">
    <div class="download-screen">
        <div class="welcome">YarOS загружается подождите.</div>
        <div id="greyProgress">
            <div id="greenBar">10%</div>
        </div>
    </div>
    <div class="wrapper hide-os">

        <div class="header">
            <div class="button" title="открыть меню"> </div>
            <ul class="menu menu-items">
                <li onclick="app.showWindow()" title="открыть вкладку приложения">Приложения</li>
                <li onclick="options.showWindow()" title="открыть вкладку настройки">Настройки</li>
                <li onclick="sysInfo.showWindow()" title="открыть вкладку система">Система</li>
                <li><a class="donation" href="https://yoomoney.ru/to/4100116303857614">Пожертвовать</a></li>
                <li><a class="report" href="https://forms.gle/dWQDAhM8pBCjmru7A">Сообщить о баге </a></li>
            </ul>
        </div>
        <div class="bottom-calendar">
            <div class="date" title="Часы"></div>
            <table id="calendar2">
                <thead>
                    <tr>
                        <td>‹</td>
                        <td colspan="5"></td>
                        <td>›</td>
                    </tr>
                    <tr>
                        <td>Пн</td>
                        <td>Вт</td>
                        <td>Ср</td>
                        <td>Чт</td>
                        <td>Пт</td>
                        <td>Сб</td>
                        <td>Вс</td>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div class="window-standart app">
        <div class="window-head">
            <span class="name-window">Приложения</span>
            <button class="close-btn" onclick="app.closeWindow()" title="закрыть">X</button>
            <button class="collapse-btn" onclick="app.folding()" title="свернуть">&lt;</button>
        </div>
        <div class="main-window">
            <img class="app-icon" title="калькулятор" onclick="calc.showWindow()" src="img/calc.png">
            <img class="app-icon" title="блокнот" onclick="notepad.showWindow()" src="img/notepad.png">
            <img class="app-icon" title="стрелец" onclick="game.showWindow()" src="img/game.png">
            <img class="app-icon" title="заметки" onclick="notes.showWindow()" src="img/notes.png">
        </div>
    </div>

    <div class="window-standart system">
        <div class="window-head-system">
            <span class="name-window">Информация о системе</span>
            <button class="close-btn" onclick="sysInfo.closeWindow()" title="закрыть">X</button>
            <button class="collapse-btn" onclick="sysInfo.folding()" title="свернуть">&lt;</button>
        </div>
        <div class="main-window">
            <p>Операционная сиcтема: YarOS</p>
            <p>Версия: 2.4.2</p>
            <p>Тип: 64(бит)</p>
            <p>Создана: 12 Апреля 2020 г.</p>
        </div>
    </div>

    <div class="window-standart options">
        <div class="window-head">
            <span class="name-window">Настройки системы</span>
            <button class="close-btn" onclick="options.closeWindow()" title="закрыть">X</button>
            <button class="collapse-btn" onclick="options.folding()" title="свернуть">&lt;</button>

        </div>
        <div class="main-window">
            <p>
                Тема:
                <select name="" id="select-theme"
                    style="background: #fefefe; border: 1px solid #c8c6c6; border-radius: 12px;color: #555555;">
                    <option value="standart">Стандартная тема</option>
                    <option value="winter">Зимняя тема</option>
                    <option value="chrismas">Новогодняя тема</option>
                    <option value="helloween">Хеллуинская тема</option>
                    <option value="birthday">Тема день рождения YarOS</option>
                </select>
            </p>
        </div>
    </div>
    <div class="window-standart calc">
        <div class="window-head">
            <span class="name-window">Калькулятор</span>
            <button class="close-btn" onclick="calc.closeWindow()" title="закрыть">X</button>
            <button class="collapse-btn" onclick="calc.folding()" title="свернуть">&lt;</button>
        </div>
        <div class="main-window main-window-no-padding">
            <div class="container">
                <div class="view">0</div>
            </div>

            <script src="calc/calc.js"></script>

        </div>
    </div>
    <div class="window-standart notepad">
        <div class="window-head">
            <span class="name-window">Блокнот</span>
            <button class="close-btn" onclick="notepad.closeWindow()" title="закрыть">X</button>
            <button class="collapse-btn" onclick="notepad.folding()" title="свернуть">&lt;</button>
        </div>
        <div>
            <textarea name="" id="notepad-text" style="border: 0px solid black;" onchange="saveNotepad()" cols="47"
                rows="14"></textarea>
        </div>
    </div>
    <div class="window-standart game">
        <div class="window-head">
            <span class="name-window">Стрелец</span>
            <button class="close-btn" onclick="game.closeWindow()" title="закрыть">X</button>
            <button class="collapse-btn" onclick="game.folding()" title="свернуть">&lt;</button>
        </div>
        <div class="main-window" style="text-align: center;">
            <p>Компьютер загадал мишень.</p>
            <p>попробуйте угадать какую.</p>
            <p style="text-align: center">Результат: <span id="result"></span></p>
            <img class="vanty" onclick="startGame(1)" src="img/target.png" alt="" height="59px">
            <img class="vanty" onclick="startGame(2)" src="img/target.png" alt="" height="59px">
            <img class="vanty" onclick="startGame(3)" src="img/target.png" alt="" height="59px">
            <p>
        </div>
    </div>
    <div class="window-standart beta">
        <div class="window-head">
            <span class="name-window">Бета</span>
            <button class="close-btn" onclick="beta.closeWindow()" title="закрыть">X</button>
            <button class="collapse-btn" onclick="beta.folding()" title="свернуть">&lt;</button>
        </div>
        <div class="main-window">
            <p>Вы попали на сайт YarOS.</p>
            <p>Помните что это бето-тестирование
            <p>
            <p>и тут много багов.</p>
        </div>
    </div>
    <div class="window-standart notes">
        <div class="window-head">
            <span class="name-window">Заметки</span>
            <button class="close-btn" onclick="notes.closeWindow()" title="закрыть">X</button>
            <button class="collapse-btn" onclick="notes.folding()" title="свернуть">&lt;</button>
        </div>
        <div class="main-window" style="text-align: center;">
            <form> <input type="text"> <input type="checkbox"><label>Сделано</label><br></form>
            <form> <input type="text"> <input type="checkbox"><label>Сделано</label><br></form>
            <form> <input type="text"> <input type="checkbox"><label>Сделано</label><br></form>
            <form> <input type="text"> <input type="checkbox"><label>Сделано</label><br></form>
            <form> <input type="text"> <input type="checkbox"><label>Сделано</label><br></form>
            <form> <input type="text"> <input type="checkbox"><label>Сделано</label><br></form>
        </div>
    </div>
    <div class="folding">
    </div>
    <script>
        function randColor() {
            var r = Math.floor(Math.random() * (256)),
                g = Math.floor(Math.random() * (256)),
                b = Math.floor(Math.random() * (256));
            return '#' + r.toString(16) + g.toString(16) + b.toString(16);
        }
        function startGame(number) {
            min = 1;
            max = 4;
            digit = Math.floor(Math.random() * (max - min)) + min;
            console.log(digit);
            result = document.getElementById('result')
            if (number == digit) {
                result.innerHTML = 'Вы угадали';
            } else {
                result.innerHTML = "Вы не угадали";
            }
            result.style.background = randColor();

        }
        class OsWindow {

            constructor(className) {
                this.selector = '.' + className; //Alex: используется здесь и в makeDraggable()
                this.element = document.querySelector(this.selector);
            }

            showWindow() {
                this.element.style.display = 'block';
                this.element.style.zIndex = OsWindow.prototype.priore++; //Alex
            }

            closeWindow() {
                this.element.style.display = 'none';

            }

            folding() {
                this.element.style.left = '-1000px';
                var newEl = document.createElement('div');
                newEl.className = 'window-fold';
                newEl.title = this.element.children[0].children[0].innerHTML.toUpperCase();
                newEl.innerHTML = this.element.children[0].children[0].innerHTML[0].toUpperCase();
                var cls = this.selector; //Alex
                newEl.onclick = function () {
                    OsWindow.prototype.priore++;
                    document.querySelector(cls).style.left = "35%";
                    document.querySelector(cls).style.zIndex = OsWindow.prototype.priore;
                    newEl.remove();
                }
                document.querySelector('.folding').append(newEl);
            }
        }
        OsWindow.prototype.priore = 1;


        var app = new OsWindow('app');
        var options = new OsWindow('options');
        var sysInfo = new OsWindow('system');
        var calc = new OsWindow('calc');
        var notepad = new OsWindow('notepad');
        var game = new OsWindow('game');
        var beta = new OsWindow('beta');
        var notes = new OsWindow('notes');


        const windows = [app, options, sysInfo, calc, notepad, game, beta, notes]; //Alex

        /* //Alex: Не используется
        function openWindow(elClass) {
            document.querySelector('.' + elClass).style.display = 'block';
            document.querySelector('.' + elClass).style.zIndex = priore;
            priore++
        }
        */

        /* Функция смены темы */
        document.querySelector('#select-theme').onchange = function () {
            var sel = document.querySelector('#select-theme');
            document.querySelector('#theme').href = 'css/' + sel.value + '.css';

            localStorage.theme = sel.value;
        }

        //        function folding(cls) {
        //            var el = document.querySelector('.' + cls);
        //            el.style.left = '-1000px';
        //            var newEl = document.createElement('div');
        //            newEl.className = 'window-fold';
        //            newEl.innerHTML = el.children[0].children[0].innerHTML[0].toUpperCase();
        //            newEl.onclick = function() {
        //                priore++
        //                el.style.left = "35%";
        //                el.style.zIndex = priore;
        //                newEl.remove();
        //            }
        //            document.querySelector('.folding').append(newEl);
        //        }

        document.querySelector('.button').onclick = function () {
            document.querySelector('.menu').classList.toggle('menu-open')
            document.querySelector('.button').classList.toggle('button-menu-open')

        }
        window.onload = setInterval(function () {
            a = new Date();
            document.querySelector('.date').innerHTML = a.toLocaleTimeString();

            //Alex
            windows.forEach(function (w) {
                makeDraggable(w.selector);
            });

        }, 1000)

        function move() {
            var elem = document.getElementById("greenBar");
            var width = 10;
            var id = setInterval(frame, 40);

            function frame() {
                if (width >= 100) {
                    clearInterval(id);
                } else {
                    width++;
                    elem.style.width = width + '%';
                    elem.innerHTML = width * 1 + '%';

                }

            }

        }
        move()

        function download() {
            if (localStorage.theme) {
                document.querySelector('#theme').href = '/css/' + localStorage.theme + '.css';
                document.querySelector('#select-theme').value = localStorage.theme;
            }
            document.querySelector('body').classList.toggle('start-download');
            document.querySelector('.download-screen').style.display = "none";
            document.querySelector('.wrapper').classList.toggle('hide-os');
        }
        setTimeout(download, 3700);


        /*
        var dragWindow = document.querySelector('.app');

        dragWindow.ondblclick = function(e) { // 1. отследить нажатие

            // подготовить к перемещению
            // 2. разместить на том же месте, но в абсолютных координатах
            moveAt(e);
            // переместим в body, чтобы мяч был точно не внутри position:relative
            document.body.appendChild(dragWindow);

            dragWindow.style.zIndex = 1000; // показывать мяч над другими элементами

            // передвинуть мяч под координаты курсора
            // и сдвинуть на половину ширины/высоты для центрирования
            function moveAt(e) {
                console.log(e.pageY);
                if (e.pageX < 1146 & e.pageX > 132 & e.pageY > 169 & e.pageY < 562) {
                    dragWindow.style.left = e.pageX - dragWindow.offsetWidth / 2 + 'px';
                    dragWindow.style.top = e.pageY - dragWindow.offsetHeight / 2 + 'px';
                }

            }

            // 3, перемещать по экрану
            document.onmousemove = function(e) {
                moveAt(e);
            }

            // 4. отследить окончание переноса
            dragWindow.onmouseup = function() {
                document.onmousemove = null;
                dragWindow.onmouseup = null;
            }
        }
        */

        //Alex
        function makeDraggable(sel) {
            var wnd = document.querySelector(sel);
            wnd.ondblclick = function (e) {
                // подготовить к перемещению
                // 2. разместить на том же месте, но в абсолютных координатах
                moveAt(e);
                // переместим в body, чтобы мяч был точно не внутри position:relative
                document.body.appendChild(wnd);

                wnd.style.zIndex = 1000; // показывать мяч над другими элементами

                // передвинуть мяч под координаты курсора
                // и сдвинуть на половину ширины/высоты для центрирования
                function moveAt(e) {
                    console.log('x ' + e.pageX);
                    console.log('y ' + e.pageY);
                    if (e.pageX < 1146 & e.pageX > 132 & e.pageY > 169 & e.pageY < 562) {
                        wnd.style.left = e.pageX - wnd.offsetWidth / 2 + 'px';
                        wnd.style.top = e.pageY - wnd.offsetHeight / 2 + 'px';
                    }

                }

                // 3, перемещать по экрану
                document.onmousemove = function (e) {
                    moveAt(e);
                }

                // 4. отследить окончание переноса
                wnd.onmouseup = function () {
                    document.onmousemove = null;
                    wnd.onmouseup = null;
                }
            }
        }


        function Calendar2(id, year, month) {
            var Dlast = new Date(year, month + 1, 0).getDate(),
                D = new Date(year, month, Dlast),
                DNlast = new Date(D.getFullYear(), D.getMonth(), Dlast).getDay(),
                DNfirst = new Date(D.getFullYear(), D.getMonth(), 1).getDay(),
                calendar = '<tr>',
                month = ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"];
            if (DNfirst != 0) {
                for (var i = 1; i < DNfirst; i++) calendar += '<td>';
            } else {
                for (var i = 0; i < 6; i++) calendar += '<td>';
            }
            for (var i = 1; i <= Dlast; i++) {
                if (i == new Date().getDate() && D.getFullYear() == new Date().getFullYear() && D.getMonth() == new Date().getMonth()) {
                    calendar += '<td class="today">' + i;
                } else {
                    calendar += '<td>' + i;
                }
                if (new Date(D.getFullYear(), D.getMonth(), i).getDay() == 0) {
                    calendar += '<tr>';
                }
            }
            for (var i = DNlast; i < 7; i++) calendar += '<td>&nbsp;';
            document.querySelector('#' + id + ' tbody').innerHTML = calendar;
            document.querySelector('#' + id + ' thead td:nth-child(2)').innerHTML = month[D.getMonth()] + ' ' + D.getFullYear();
            document.querySelector('#' + id + ' thead td:nth-child(2)').dataset.month = D.getMonth();
            document.querySelector('#' + id + ' thead td:nth-child(2)').dataset.year = D.getFullYear();
            if (document.querySelectorAll('#' + id + ' tbody tr').length < 6) { // чтобы при перелистывании месяцев не "подпрыгивала" вся страница, добавляется ряд пустых клеток. Итог: всегда 6 строк для цифр
                document.querySelector('#' + id + ' tbody').innerHTML += '<tr><td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;';
            }
        }
        if (localStorage.notepad) {
            document.querySelector('#notepad-text').value = localStorage.notepad;
        }


        function saveNotepad() {
            localStorage.notepad = document.querySelector('#notepad-text').value;
        }
        Calendar2("calendar2", new Date().getFullYear(), new Date().getMonth());
        // переключатель минус месяц
        document.querySelector('#calendar2 thead tr:nth-child(1) td:nth-child(1)').onclick = function () {
            Calendar2("calendar2", document.querySelector('#calendar2 thead td:nth-child(2)').dataset.year, parseFloat(document.querySelector('#calendar2 thead td:nth-child(2)').dataset.month) - 1);
        }
        // переключатель плюс месяц
        document.querySelector('#calendar2 thead tr:nth-child(1) td:nth-child(3)').onclick = function () {
            Calendar2("calendar2", document.querySelector('#calendar2 thead td:nth-child(2)').dataset.year, parseFloat(document.querySelector('#calendar2 thead td:nth-child(2)').dataset.month) + 1);
        }

    </script>
</body>

</html>